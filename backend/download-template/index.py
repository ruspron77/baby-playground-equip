import json
from io import BytesIO
import base64
from openpyxl import Workbook
from openpyxl.styles import Font, PatternFill, Alignment, Border, Side

def handler(event: dict, context) -> dict:
    '''–ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel-—à–∞–±–ª–æ–Ω–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏'''
    
    method = event.get('httpMethod', 'GET')
    
    if method == 'OPTIONS':
        return {
            'statusCode': 200,
            'headers': {
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'GET, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type'
            },
            'body': '',
            'isBase64Encoded': False
        }
    
    if method == 'GET':
        wb = Workbook()
        
        # –£–¥–∞–ª—è–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ª–∏—Å—Ç
        if 'Sheet' in wb.sheetnames:
            del wb['Sheet']
        
        # –°–æ–∑–¥–∞–µ–º –ª–∏—Å—Ç "–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"
        ws = wb.create_sheet("–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ")
        
        # –ó–∞–≥–æ–ª–æ–≤–∫–∏ (—Å—Ç—Ä–æ–∫–∞ 1)
        headers = ['–ö–∞—Ä—Ç–∏–Ω–∫–∞', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', '–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è', '–ü–æ–¥–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è', '–ü–æ–¥–ø–æ–¥–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è', '–ê—Ä—Ç–∏–∫—É–ª', '–ù–∞–∑–≤–∞–Ω–∏–µ', '–†–∞–∑–º–µ—Ä—ã', '–ï–¥. –∏–∑–º.', '–¶–µ–Ω–∞']
        ws.append(headers)
        
        # –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        header_fill = PatternFill(start_color="4472C4", end_color="4472C4", fill_type="solid")
        header_font = Font(bold=True, color="FFFFFF", size=11)
        thin_border = Border(
            left=Side(style='thin'),
            right=Side(style='thin'),
            top=Side(style='thin'),
            bottom=Side(style='thin')
        )
        
        for col_num in range(1, 11):
            cell = ws.cell(row=1, column=col_num)
            cell.fill = header_fill
            cell.font = header_font
            cell.alignment = Alignment(horizontal='center', vertical='center')
            cell.border = thin_border
        
        # –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö (—Å—Ç—Ä–æ–∫–∏ 2-5)
        examples = [
            ['', '–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', '–°—ã–ø—É—á–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã', '–ü–µ—Å–æ–∫', '', '–ë–õ-9027', '–ü–µ—Å–æ–∫ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π', '', '–º¬≥', '350'],
            ['', '–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', '–°—ã–ø—É—á–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã', '–©–µ–±–µ–Ω—å', '', '–ë–õ-9028', '–©–µ–±–µ–Ω—å –≥—Ä–∞–Ω–∏—Ç–Ω—ã–π —Ñ—Ä. 5-20', '', '—Ç', '450'],
            ['', '–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', '–ì–µ–æ—Ç–µ–∫—Å—Ç–∏–ª—å', '', '', '–ë–õ-9030', '–ì–µ–æ—Ç–µ–∫—Å—Ç–∏–ª—å 150 –≥/–º¬≤', '', '–º¬≤', '45'],
            ['', '–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', '–ë–æ—Ä–¥—é—Ä', '', '', '–ë–õ-9035', '–ë–æ—Ä–¥—é—Ä–Ω—ã–π –∫–∞–º–µ–Ω—å', '1000x200x80', '—à—Ç', '850']
        ]
        
        for row_data in examples:
            ws.append(row_data)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫
        ws.column_dimensions['A'].width = 15  # –ö–∞—Ä—Ç–∏–Ω–∫–∞
        ws.column_dimensions['B'].width = 18  # –ö–∞—Ç–µ–≥–æ—Ä–∏—è
        ws.column_dimensions['C'].width = 18  # –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è
        ws.column_dimensions['D'].width = 18  # –ü–æ–¥–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è
        ws.column_dimensions['E'].width = 20  # –ü–æ–¥–ø–æ–¥–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è
        ws.column_dimensions['F'].width = 12  # –ê—Ä—Ç–∏–∫—É–ª
        ws.column_dimensions['G'].width = 35  # –ù–∞–∑–≤–∞–Ω–∏–µ
        ws.column_dimensions['H'].width = 15  # –†–∞–∑–º–µ—Ä—ã
        ws.column_dimensions['I'].width = 10  # –ï–¥. –∏–∑–º
        ws.column_dimensions['J'].width = 10  # –¶–µ–Ω–∞
        
        # –í—ã—Å–æ—Ç–∞ —Å—Ç—Ä–æ–∫
        ws.row_dimensions[1].height = 25
        for i in range(2, 6):
            ws.row_dimensions[i].height = 20
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ª–∏—Å—Ç–µ
        ws_info = wb.create_sheet("üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è", 0)
        
        instructions = [
            ['–ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ó–ê–ü–û–õ–ù–ï–ù–ò–Æ –®–ê–ë–õ–û–ù–ê'],
            [''],
            ['–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞:'],
            ['‚Ä¢ –ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞ = –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ", "–°–ø–æ—Ä—Ç", "–ò–≥—Ä–∞")'],
            ['‚Ä¢ –í —Ñ–∞–π–ª–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∏—Å—Ç–æ–≤ - –∫–∞–∂–¥—ã–π –¥–ª—è —Å–≤–æ–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏'],
            ['‚Ä¢ –õ–∏—Å—Ç "–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ" –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–ø—É—â–µ–Ω'],
            [''],
            ['–°—Ç–æ–ª–±—Ü—ã (A-J):'],
            ['A (1) - –ö–∞—Ä—Ç–∏–Ω–∫–∞ - URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)'],
            ['B (2) - –ö–∞—Ç–µ–≥–æ—Ä–∏—è - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ")'],
            ['C (3) - –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è - –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–°—ã–ø—É—á–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã")'],
            ['D (4) - –ü–æ–¥–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ü–µ—Å–æ–∫")'],
            ['E (5) - –ü–æ–¥–ø–æ–¥–ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è - –µ—â–µ –æ–¥–Ω–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)'],
            ['F (6) - –ê—Ä—Ç–∏–∫—É–ª - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ë–õ-9027")'],
            ['G (7) - –ù–∞–∑–≤–∞–Ω–∏–µ - –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ü–µ—Å–æ–∫ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π")'],
            ['H (8) - –†–∞–∑–º–µ—Ä—ã - –≥–∞–±–∞—Ä–∏—Ç—ã —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "1500x500x800")'],
            ['I (9) - –ï–¥. –∏–∑–º - –í–ê–ñ–ù–û! –£–∫–∞–∂–∏—Ç–µ –µ–¥–∏–Ω–∏—Ü—É –∏–∑–º–µ—Ä–µ–Ω–∏—è: —à—Ç, –º, –º¬≤, –º¬≥, –∫–≥, —Ç, –ª –∏ —Ç.–¥.'],
            ['         –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ - –±—É–¥–µ—Ç "—à—Ç" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é'],
            ['J (10) - –¶–µ–Ω–∞ - –Ω–∞–ø—Ä–∏–º–µ—Ä: "25000" (—Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ —Å–∏–º–≤–æ–ª–æ–≤)'],
            [''],
            ['–ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è (—Å—Ç–æ–ª–±–µ—Ü I):'],
            ['‚Ä¢ —à—Ç - —à—Ç—É–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)'],
            ['‚Ä¢ –º - –º–µ—Ç—Ä—ã'],
            ['‚Ä¢ –º¬≤ - –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –º–µ—Ç—Ä—ã'],
            ['‚Ä¢ –º¬≥ - –∫—É–±–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä—ã'],
            ['‚Ä¢ –∫–≥ - –∫–∏–ª–æ–≥—Ä–∞–º–º—ã'],
            ['‚Ä¢ —Ç - —Ç–æ–Ω–Ω—ã'],
            ['‚Ä¢ –ª - –ª–∏—Ç—Ä—ã'],
            [''],
            ['–ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ:'],
            ['1. –£–¥–∞–ª–∏—Ç–µ —ç—Ç–æ—Ç –ª–∏—Å—Ç "üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è"'],
            ['2. –ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –ª–∏—Å—Ç "–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ" –≤ –Ω—É–∂–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ –ª–∏—Å—Ç—ã)'],
            ['3. –£–¥–∞–ª–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 2-5)'],
            ['4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–≤–æ–∏ —Ç–æ–≤–∞—Ä—ã –Ω–∞—á–∏–Ω–∞—è —Å–æ —Å—Ç—Ä–æ–∫–∏ 2'],
            ['5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª –≤ —Ñ–æ—Ä–º–∞—Ç–µ .xlsx –∏–ª–∏ .xls'],
            ['6. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å'],
            [''],
            ['‚ö†Ô∏è –í–ê–ñ–ù–û:'],
            ['‚Ä¢ –ù–ï –∏–∑–º–µ–Ω—è–π—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Å—Ç–æ–ª–±—Ü–æ–≤ A-J'],
            ['‚Ä¢ –ù–ï —É–¥–∞–ª—è–π—Ç–µ —Å—Ç—Ä–æ–∫—É –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (—Å—Ç—Ä–æ–∫—É 1)'],
            ['‚Ä¢ –ù–ï –æ—Å—Ç–∞–≤–ª—è–π—Ç–µ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –º–µ–∂–¥—É —Ç–æ–≤–∞—Ä–∞–º–∏'],
            ['‚Ä¢ –¶–µ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤, –∑–∞–ø—è—Ç—ã—Ö, —Å–∏–º–≤–æ–ª–∞ —Ä—É–±–ª—è)'],
            ['‚Ä¢ –°—Ç–æ–ª–±–µ—Ü I (–ï–¥. –∏–∑–º) - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∂–∏—Ç–µ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞!']
        ]
        
        for row_num, instruction in enumerate(instructions, 1):
            cell = ws_info.cell(row=row_num, column=1, value=instruction[0])
            if row_num == 1:
                cell.font = Font(bold=True, size=14, color="4472C4")
            elif '–í–ê–ñ–ù–û' in str(instruction[0]):
                cell.font = Font(bold=True, size=11, color="C00000")
            elif any(x in str(instruction[0]) for x in ['–°—Ç—Ä—É–∫—Ç—É—Ä–∞', '–°—Ç–æ–ª–±—Ü—ã', '–ü—Ä–∏–º–µ—Ä—ã', '–ï–¥–∏–Ω–∏—Ü—ã', '–ß—Ç–æ –¥–µ–ª–∞—Ç—å']):
                cell.font = Font(bold=True, size=11)
            else:
                cell.font = Font(size=10)
        
        ws_info.column_dimensions['A'].width = 100
        
        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ BytesIO
        excel_file = BytesIO()
        wb.save(excel_file)
        excel_file.seek(0)
        
        # –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ base64
        excel_base64 = base64.b64encode(excel_file.read()).decode('utf-8')
        
        return {
            'statusCode': 200,
            'headers': {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*'
            },
            'body': json.dumps({
                'file': excel_base64,
                'filename': 'shablon_zagruzki_tovarov.xlsx'
            }),
            'isBase64Encoded': False
        }
    
    return {
        'statusCode': 405,
        'headers': {
            'Content-Type': 'application/json',
            'Access-Control-Allow-Origin': '*'
        },
        'body': json.dumps({'error': 'Method not allowed'}),
        'isBase64Encoded': False
    }